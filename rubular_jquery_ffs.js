function$w(e){return(e=e.strip())?e.split(/\s+/):[]}function$H(e){returne&&e.constructor==Hash?e:newHash(e)}function$(e){if(1<arguments.length){for(vart=0,n=[],r=arguments.length;t<r;t++)n.push($(arguments[t]));returnn}return"string"==typeofe&&(e=document.getElementById(e)),Element.extend(e)}function$$(){returnSelector.findChildElements(document,$A(arguments))}varPrototype={Version:"1.5.0",BrowserFeatures:{XPath:!!document.evaluate},ScriptFragment:"(?:<script.*?>)((\n|\r|.)*?)(?:</script>)",emptyFunction:function(){},K:function(e){returne}},Class={create:function(){returnfunction(){this.initialize.apply(this,arguments)}}},Abstract=newObject;Object.extend=function(e,t){for(varnint)e[n]=t[n];returne},Object.extend(Object,{inspect:function(e){try{returne===undefined?"undefined":null===e?"null":e.inspect?e.inspect():e.toString()}catch(t){if(tinstanceofRangeError)return"...";throwt}},keys:function(e){vart=[];for(varnine)t.push(n);returnt},values:function(e){vart=[];for(varnine)t.push(e[n]);returnt},clone:function(e){returnObject.extend({},e)}}),Function.prototype.bind=function(){vare=this,t=$A(arguments),n=t.shift();returnfunction(){returne.apply(n,t.concat($A(arguments)))}},Function.prototype.bindAsEventListener=function(t){varn=this,r=$A(arguments);t=r.shift();returnfunction(e){returnn.apply(t,[e||window.event].concat(r).concat($A(arguments)))}},Object.extend(Number.prototype,{toColorPart:function(){vare=this.toString(16);returnthis<16?"0"+e:e},succ:function(){returnthis+1},times:function(e){return$R(0,this,!0).each(e),this}});varTry={these:function(){for(vare,t=0,n=arguments.length;t<n;t++){varr=arguments[t];try{e=r();break}catch(i){}}returne}},PeriodicalExecuter=Class.create();PeriodicalExecuter.prototype={initialize:function(e,t){this.callback=e,this.frequency=t,this.currentlyExecuting=!1,this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),1e3*this.frequency)},stop:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.callback(this)}finally{this.currentlyExecuting=!1}}},String.interpret=function(e){returnnull==e?"":String(e)},Object.extend(String.prototype,{gsub:function(e,t){varn,r="",i=this;for(t=arguments.callee.prepareReplacement(t);0<i.length;)(n=i.match(e))?(r+=i.slice(0,n.index),r+=String.interpret(t(n)),i=i.slice(n.index+n[0].length)):(r+=i,i="");returnr},sub:function(e,t,n){returnt=this.gsub.prepareReplacement(t),n=n===undefined?1:n,this.gsub(e,function(e){return--n<0?e[0]:t(e)})},scan:function(e,t){returnthis.gsub(e,t),this},truncate:function(e,t){returne=e||30,t=t===undefined?"...":t,this.length>e?this.slice(0,e-t.length)+t:this},strip:function(){returnthis.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){returnthis.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){returnthis.replace(newRegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){vare=newRegExp(Prototype.ScriptFragment,"img"),t=newRegExp(Prototype.ScriptFragment,"im");return(this.match(e)||[]).map(function(e){return(e.match(t)||["",""])[1]})},evalScripts:function(){returnthis.extractScripts().map(function(script){returneval(script)})},escapeHTML:function(){vare=document.createElement("div"),t=document.createTextNode(this);returne.appendChild(t),e.innerHTML},unescapeHTML:function(){vare=document.createElement("div");returne.innerHTML=this.stripTags(),e.childNodes[0]?1<e.childNodes.length?$A(e.childNodes).inject("",function(e,t){returne+t.nodeValue}):e.childNodes[0].nodeValue:""},toQueryParams:function(e){vart=this.strip().match(/([^?#]*)(#.*)?$/);returnt?t[1].split(e||"&").inject({},function(e,t){if((t=t.split("="))[0]){varn=decodeURIComponent(t[0]),r=t[1]?decodeURIComponent(t[1]):undefined;e[n]!==undefined?(e[n].constructor!=Array&&(e[n]=[e[n]]),r&&e[n].push(r)):e[n]=r}returne}):{}},toArray:function(){returnthis.split("")},succ:function(){returnthis.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},camelize:function(){vare=this.split("-"),t=e.length;if(1==t)returne[0];for(varn="-"==this.charAt(0)?e[0].charAt(0).toUpperCase()+e[0].substring(1):e[0],r=1;r<t;r++)n+=e[r].charAt(0).toUpperCase()+e[r].substring(1);returnn},capitalize:function(){returnthis.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){returnthis.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){returnthis.gsub(/_/,"-")},inspect:function(e){vart=this.replace(/\\/g,"\\\\");returne?'"'+t.replace(/"/g,'\\"')+'"':"'"+t.replace(/'/g,"\\'")+"'"}}),String.prototype.gsub.prepareReplacement=function(e){if("function"==typeofe)returne;vart=newTemplate(e);returnfunction(e){returnt.evaluate(e)}},String.prototype.parseQuery=String.prototype.toQueryParams;varTemplate=Class.create();Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/,Template.prototype={initialize:function(e,t){this.template=e.toString(),this.pattern=t||Template.Pattern},evaluate:function(n){returnthis.template.gsub(this.pattern,function(e){vart=e[1];return"\\"==t?e[2]:t+String.interpret(n[e[3]])})}};var$break=newObject,$continue=newObject,Enumerable={each:function(n){varr=0;try{this._each(function(e){try{n(e,r++)}catch(t){if(t!=$continue)throwt}})}catch(e){if(e!=$break)throwe}returnthis},eachSlice:function(e,t){for(varn=-e,r=[],i=this.toArray();(n+=e)<i.length;)r.push(i.slice(n,n+e));returnr.map(t)},all:function(n){varr=!0;returnthis.each(function(e,t){if(!(r=r&&!!(n||Prototype.K)(e,t)))throw$break}),r},any:function(n){varr=!1;returnthis.each(function(e,t){if(r=!!(n||Prototype.K)(e,t))throw$break}),r},collect:function(n){varr=[];returnthis.each(function(e,t){r.push((n||Prototype.K)(e,t))}),r},detect:function(n){varr;returnthis.each(function(e,t){if(n(e,t))throwr=e,$break}),r},findAll:function(n){varr=[];returnthis.each(function(e,t){n(e,t)&&r.push(e)}),r},grep:function(n,r){vari=[];returnthis.each(function(e,t){e.toString().match(n)&&i.push((r||Prototype.K)(e,t))}),i},include:function(t){varn=!1;returnthis.each(function(e){if(e==t)thrown=!0,$break}),n},inGroupsOf:function(t,n){returnn=n===undefined?null:n,this.eachSlice(t,function(e){for(;e.length<t;)e.push(n);returne})},inject:function(n,r){returnthis.each(function(e,t){n=r(n,e,t)}),n},invoke:function(t){varn=$A(arguments).slice(1);returnthis.map(function(e){returne[t].apply(e,n)})},max:function(n){varr;returnthis.each(function(e,t){e=(n||Prototype.K)(e,t),(r==undefined||r<=e)&&(r=e)}),r},min:function(n){varr;returnthis.each(function(e,t){e=(n||Prototype.K)(e,t),(r==undefined||e<r)&&(r=e)}),r},partition:function(n){varr=[],i=[];returnthis.each(function(e,t){((n||Prototype.K)(e,t)?r:i).push(e)}),[r,i]},pluck:function(t){varn=[];returnthis.each(function(e){n.push(e[t])}),n},reject:function(n){varr=[];returnthis.each(function(e,t){n(e,t)||r.push(e)}),r},sortBy:function(n){returnthis.map(function(e,t){return{value:e,criteria:n(e,t)}}).sort(function(e,t){varn=e.criteria,r=t.criteria;returnn<r?-1:r<n?1:0}).pluck("value")},toArray:function(){returnthis.map()},zip:function(){varn=Prototype.K,e=$A(arguments);"function"==typeofe.last()&&(n=e.pop());varr=[this].concat(e).map($A);returnthis.map(function(e,t){returnn(r.pluck(t))})},size:function(){returnthis.toArray().length},inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray});var$A=Array.from=function(e){if(!e)return[];if(e.toArray)returne.toArray();for(vart=[],n=0,r=e.length;n<r;n++)t.push(e[n]);returnt};Object.extend(Array.prototype,Enumerable),Array.prototype._reverse||(Array.prototype._reverse=Array.prototype.reverse),Object.extend(Array.prototype,{_each:function(e){for(vart=0,n=this.length;t<n;t++)e(this[t])},clear:function(){returnthis.length=0,this},first:function(){returnthis[0]},last:function(){returnthis[this.length-1]},compact:function(){returnthis.select(function(e){returnnull!=e})},flatten:function(){returnthis.inject([],function(e,t){returne.concat(t&&t.constructor==Array?t.flatten():[t])})},without:function(){vart=$A(arguments);returnthis.select(function(e){return!t.include(e)})},indexOf:function(e){for(vart=0,n=this.length;t<n;t++)if(this[t]==e)returnt;return-1},reverse:function(e){return(!1!==e?this:this.toArray())._reverse()},reduce:function(){return1<this.length?this:this[0]},uniq:function(){returnthis.inject([],function(e,t){returne.include(t)?e:e.concat([t])})},clone:function(){return[].concat(this)},size:function(){returnthis.length},inspect:function(){return"["+this.map(Object.inspect).join(",")+"]"}}),Array.prototype.toArray=Array.prototype.clone,window.opera&&(Array.prototype.concat=function(){for(vare=[],t=0,n=this.length;t<n;t++)e.push(this[t]);for(t=0,n=arguments.length;t<n;t++)if(arguments[t].constructor==Array)for(varr=0,i=arguments[t].length;r<i;r++)e.push(arguments[t][r]);elsee.push(arguments[t]);returne});varHash=function(e){Object.extend(this,e||{})};Object.extend(Hash,{toQueryString:function(e){varn=[];returnthis.prototype._each.call(e,function(e){if(e.key){if(e.value&&e.value.constructor==Array){vart=e.value.compact();if(!(t.length<2))returnkey=encodeURIComponent(e.key),voidt.each(function(e){e=e!=undefined?encodeURIComponent(e):"",n.push(key+"="+encodeURIComponent(e))});e.value=t.reduce()}e.value==undefined&&(e[1]=""),n.push(e.map(encodeURIComponent).join("="))}}),n.join("&")}}),Object.extend(Hash.prototype,Enumerable),Object.extend(Hash.prototype,{_each:function(e){for(vartinthis){varn=this[t];if(!n||n!=Hash.prototype[t]){varr=[t,n];r.key=t,r.value=n,e(r)}}},keys:function(){returnthis.pluck("key")},values:function(){returnthis.pluck("value")},merge:function(e){return$H(e).inject(this,function(e,t){returne[t.key]=t.value,e})},remove:function(){for(vare,t=0,n=arguments.length;t<n;t++){varr=this[arguments[t]];r!==undefined&&(e===undefined?e=r:(e.constructor!=Array&&(e=[e]),e.push(r))),deletethis[arguments[t]]}returne},toQueryString:function(){returnHash.toQueryString(this)},inspect:function(){return"#<Hash:{"+this.map(function(e){returne.map(Object.inspect).join(":")}).join(",")+"}>"}}),ObjectRange=Class.create(),Object.extend(ObjectRange.prototype,Enumerable),Object.extend(ObjectRange.prototype,{initialize:function(e,t,n){this.start=e,this.end=t,this.exclusive=n},_each:function(e){for(vart=this.start;this.include(t);)e(t),t=t.succ()},include:function(e){return!(e<this.start)&&(this.exclusive?e<this.end:e<=this.end)}});var$R=function(e,t,n){returnnewObjectRange(e,t,n)},Ajax={getTransport:function(){returnTry.these(function(){returnnewXMLHttpRequest},function(){returnnewActiveXObject("Msxml2.XMLHTTP")},function(){returnnewActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0,Responders:{responders:[],_each:function(e){this.responders._each(e)},register:function(e){this.include(e)||this.responders.push(e)},unregister:function(e){this.responders=this.responders.without(e)},dispatch:function(n,r,i,s){this.each(function(e){if("function"==typeofe[n])try{e[n].apply(e,[r,i,s])}catch(t){}})}}};if(Object.extend(Ajax.Responders,Enumerable),Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}}),Ajax.Base=function(){},Ajax.Base.prototype={setOptions:function(e){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:""},Object.extend(this.options,e||{}),this.options.method=this.options.method.toLowerCase(),"string"==typeofthis.options.parameters&&(this.options.parameters=this.options.parameters.toQueryParams())}},Ajax.Request=Class.create(),Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],Ajax.Request.prototype=Object.extend(newAjax.Base,{_complete:!1,initialize:function(e,t){this.transport=Ajax.getTransport(),this.setOptions(t),this.request(e)},request:function(e){this.url=e,this.method=this.options.method;vart=this.options.parameters;["get","post"].include(this.method)||(t._method=this.method,this.method="post"),(t=Hash.toQueryString(t))&&/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&(t+="&_="),"get"==this.method&&t&&(this.url+=(-1<this.url.indexOf("?")?"&":"?")+t);try{Ajax.Responders.dispatch("onCreate",this,this.transport),this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous),this.options.asynchronous&&setTimeout(function(){this.respondToReadyState(1)}.bind(this),10),this.transport.onreadystatechange=this.onStateChange.bind(this),this.setRequestHeaders();varn="post"==this.method?this.options.postBody||t:null;this.transport.send(n),!this.options.asynchronous&&this.transport.overrideMimeType&&this.onStateChange()}catch(r){this.dispatchException(r)}},onStateChange:function(){vare=this.transport.readyState;1<e&&(4!=e||!this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){vart={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript,text/html,application/xml,text/xml,*/*"};if("post"==this.method&&(t["Content-type"]=this.options.contentType+(this.options.encoding?";charset="+this.options.encoding:""),this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005&&(t.Connection="close")),"object"==typeofthis.options.requestHeaders){vare=this.options.requestHeaders;if("function"==typeofe.push)for(varn=0,r=e.length;n<r;n+=2)t[e[n]]=e[n+1];else$H(e).each(function(e){t[e.key]=e.value})}for(variint)this.transport.setRequestHeader(i,t[i])},success:function(){return!this.transport.status||200<=this.transport.status&&this.transport.status<300},respondToReadyState:function(e){vart=Ajax.Request.Events[e],n=this.transport,r=this.evalJSON();if("Complete"==t){try{this._complete=!0,(this.options["on"+this.transport.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(n,r)}catch(i){this.dispatchException(i)}(this.getHeader("Content-type")||"text/javascript").strip().match(/^(text|application)\/(x-)?(java|ecma)script(;.*)?$/i)&&this.evalResponse()}try{(this.options["on"+t]||Prototype.emptyFunction)(n,r),Ajax.Responders.dispatch("on"+t,this,n,r)}catch(i){this.dispatchException(i)}"Complete"==t&&(this.transport.onreadystatechange=Prototype.emptyFunction)},getHeader:function(e){try{returnthis.transport.getResponseHeader(e)}catch(t){returnnull}},evalJSON:function(){try{varjson=this.getHeader("X-JSON");returnjson?eval("("+json+")"):null}catch(e){returnnull}},evalResponse:function(){try{returneval(this.transport.responseText)}catch(e){this.dispatchException(e)}},dispatchException:function(e){(this.options.onException||Prototype.emptyFunction)(this,e),Ajax.Responders.dispatch("onException",this,e)}}),Ajax.Updater=Class.create(),Object.extend(Object.extend(Ajax.Updater.prototype,Ajax.Request.prototype),{initialize:function(e,t,n){this.container={success:e.success||e,failure:e.failure||(e.success?null:e)},this.transport=Ajax.getTransport(),this.setOptions(n);varr=this.options.onComplete||Prototype.emptyFunction;this.options.onComplete=function(e,t){this.updateContent(),r(e,t)}.bind(this),this.request(t)},updateContent:function(){vare=this.container[this.success()?"success":"failure"],t=this.transport.responseText;if(!this.options.insertion){t=t.replaceAll("\\\\","\\);}this.options.evalScripts||(t=t.stripScripts()),(e=$(e))&&(this.options.insertion?newthis.options.insertion(e,t):e.update(t)),this.success()&&this.onComplete&&setTimeout(this.onComplete.bind(this),10)}}),Ajax.PeriodicalUpdater=Class.create(),Ajax.PeriodicalUpdater.prototype=Object.extend(newAjax.Base,{initialize:function(e,t,n){this.setOptions(n),this.onComplete=this.options.onComplete,this.frequency=this.options.frequency||2,this.decay=this.options.decay||1,this.updater={},this.container=e,this.url=t,this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this),this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined,clearTimeout(this.timer),(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(e){this.options.decay&&(this.decay=e.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=e.responseText),this.timer=setTimeout(this.onTimerEvent.bind(this),this.decay*this.frequency*1e3)},onTimerEvent:function(){this.updater=newAjax.Updater(this.container,this.url,this.options)}}),Prototype.BrowserFeatures.XPath&&(document._getElementsByXPath=function(e,t){for(varn=[],r=document.evaluate(e,$(t)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),i=0,s=r.snapshotLength;i<s;i++)n.push(r.snapshotItem(i));returnn}),document.getElementsByClassName=function(e,t){if(Prototype.BrowserFeatures.XPath){varn=".//*[contains(concat('',@class,''),'"+e+"')]";returndocument._getElementsByXPath(n,t)}for(varr,i=($(t)||document.body).getElementsByTagName("*"),s=[],o=0,a=i.length;o<a;o++)r=i[o],Element.hasClassName(r,e)&&s.push(Element.extend(r));returns},!window.Element)varElement=newObject;Element.extend=function(e){if(!e||_nativeExtensions||3==e.nodeType)returne;if(!e._extended&&e.tagName&&e!=window){vart=Object.clone(Element.Methods),n=Element.extend.cache;for(varrin"FORM"==e.tagName&&Object.extend(t,Form.Methods),["INPUT","TEXTAREA","SELECT"].include(e.tagName)&&Object.extend(t,Form.Element.Methods),Object.extend(t,Element.Methods.Simulated),t){vari=t[r];"function"!=typeofi||rine||(e[r]=n.findOrStore(i))}}returne._extended=!0,e},Element.extend.cache={findOrStore:function(e){returnthis[e]=this[e]||function(){returne.apply(null,[this].concat($A(arguments)))}}},Element.Methods={visible:function(e){return"none"!=$(e).style.display},toggle:function(e){returne=$(e),Element[Element.visible(e)?"hide":"show"](e),e},hide:function(e){return$(e).style.display="none",e},show:function(e){return$(e).style.display="",e},remove:function(e){return(e=$(e)).parentNode.removeChild(e),e},update:function(e,t){returnt=void0===t?"":t.toString(),$(e).innerHTML=t.stripScripts(),setTimeout(function(){t.evalScripts()},10),e},replace:function(e,t){if(e=$(e),t=void0===t?"":t.toString(),e.outerHTML)e.outerHTML=t.stripScripts();else{varn=e.ownerDocument.createRange();n.selectNodeContents(e),e.parentNode.replaceChild(n.createContextualFragment(t.stripScripts()),e)}returnsetTimeout(function(){t.evalScripts()},10),e},inspect:function(i){vars="<"+(i=$(i)).tagName.toLowerCase();return$H({id:"id",className:"class"}).each(function(e){vart=e.first(),n=e.last(),r=(i[t]||"").toString();r&&(s+=""+n+"="+r.inspect(!0))}),s+">"},recursivelyCollect:function(e,t){e=$(e);for(varn=[];e=e[t];)1==e.nodeType&&n.push(Element.extend(e));returnn},ancestors:function(e){return$(e).recursivelyCollect("parentNode")},descendants:function(e){return$A($(e).getElementsByTagName("*"))},immediateDescendants:function(e){if(!(e=$(e).firstChild))return[];for(;e&&1!=e.nodeType;)e=e.nextSibling;returne?[e].concat($(e).nextSiblings()):[]},previousSiblings:function(e){return$(e).recursivelyCollect("previousSibling")},nextSiblings:function(e){return$(e).recursivelyCollect("nextSibling")},siblings:function(e){return(e=$(e)).previousSiblings().reverse().concat(e.nextSiblings())},match:function(e,t){return"string"==typeoft&&(t=newSelector(t)),t.match($(e))},up:function(e,t,n){returnSelector.findElement($(e).ancestors(),t,n)},down:function(e,t,n){returnSelector.findElement($(e).descendants(),t,n)},previous:function(e,t,n){returnSelector.findElement($(e).previousSiblings(),t,n)},next:function(e,t,n){returnSelector.findElement($(e).nextSiblings(),t,n)},getElementsBySelector:function(){vare=$A(arguments),t=$(e.shift());returnSelector.findChildElements(t,e)},getElementsByClassName:function(e,t){returndocument.getElementsByClassName(t,e)},readAttribute:function(e,t){if(e=$(e),document.all&&!window.opera){varn=Element._attributeTranslations;if(n.values[t])returnn.values[t](e,t);n.names[t]&&(t=n.names[t]);varr=e.attributes[t];if(r)returnr.nodeValue}returne.getAttribute(t)},getHeight:function(e){return$(e).getDimensions().height},getWidth:function(e){return$(e).getDimensions().width},classNames:function(e){returnnewElement.ClassNames(e)},hasClassName:function(e,t){if(e=$(e)){varn=e.className;return0!=n.length&&!(n!=t&&!n.match(newRegExp("(^|\\s)"+t+"(\\s|$)")))}},addClassName:function(e,t){if(e=$(e))returnElement.classNames(e).add(t),e},removeClassName:function(e,t){if(e=$(e))returnElement.classNames(e).remove(t),e},toggleClassName:function(e,t){if(e=$(e))returnElement.classNames(e)[e.hasClassName(t)?"remove":"add"](t),e},observe:function(){returnEvent.observe.apply(Event,arguments),$A(arguments).first()},stopObserving:function(){returnEvent.stopObserving.apply(Event,arguments),$A(arguments).first()},cleanWhitespace:function(e){for(vart=(e=$(e)).firstChild;t;){varn=t.nextSibling;3!=t.nodeType||/\S/.test(t.nodeValue)||e.removeChild(t),t=n}returne},empty:function(e){return$(e).innerHTML.match(/^\s*$/)},descendantOf:function(e,t){for(e=$(e),t=$(t);e=e.parentNode;)if(e==t)return!0;return!1},scrollTo:function(e){e=$(e);vart=Position.cumulativeOffset(e);returnwindow.scrollTo(t[0],t[1]),e},getStyle:function(e,t){e=$(e),["float","cssFloat"].include(t)&&(t="undefined"!=typeofe.style.styleFloat?"styleFloat":"cssFloat"),t=t.camelize();varn=e.style[t];if(!n)if(document.defaultView&&document.defaultView.getComputedStyle){varr=document.defaultView.getComputedStyle(e,null);n=r?r[t]:null}elsee.currentStyle&&(n=e.currentStyle[t]);return"auto"==n&&["width","height"].include(t)&&"none"!=e.getStyle("display")&&(n=e["offset"+t.capitalize()]+"px"),window.opera&&["left","top","right","bottom"].include(t)&&"static"==Element.getStyle(e,"position")&&(n="auto"),"opacity"==t?n?parseFloat(n):(n=(e.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))&&n[1]?parseFloat(n[1])/100:1:"auto"==n?null:n},setStyle:function(e,t){for(varnine=$(e),t){varr=t[n];"opacity"==n?1==r?(r=/Gecko/.test(navigator.userAgent)&&!/Konqueror|Safari|KHTML/.test(navigator.userAgent)?.999999:1,/MSIE/.test(navigator.userAgent)&&!window.opera&&(e.style.filter=e.getStyle("filter").replace(/alpha\([^\)]*\)/gi,""))):""==r?/MSIE/.test(navigator.userAgent)&&!window.opera&&(e.style.filter=e.getStyle("filter").replace(/alpha\([^\)]*\)/gi,"")):(r<1e-5&&(r=0),/MSIE/.test(navigator.userAgent)&&!window.opera&&(e.style.filter=e.getStyle("filter").replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+100*r+")")):["float","cssFloat"].include(n)&&(n="undefined"!=typeofe.style.styleFloat?"styleFloat":"cssFloat"),e.style[n.camelize()]=r}returne},getDimensions:function(e){vart=$(e=$(e)).getStyle("display");if("none"!=t&&null!=t)return{width:e.offsetWidth,height:e.offsetHeight};varn=e.style,r=n.visibility,i=n.position,s=n.display;n.visibility="hidden",n.position="absolute",n.display="block";varo=e.clientWidth,a=e.clientHeight;returnn.display=s,n.position=i,n.visibility=r,{width:o,height:a}},makePositioned:function(e){e=$(e);vart=Element.getStyle(e,"position");return"static"!=t&&t||(e._madePositioned=!0,e.style.position="relative",window.opera&&(e.style.top=0,e.style.left=0)),e},undoPositioned:function(e){return(e=$(e))._madePositioned&&(e._madePositioned=undefined,e.style.position=e.style.top=e.style.left=e.style.bottom=e.style.right=""),e},makeClipping:function(e){return(e=$(e))._overflow||(e._overflow=e.style.overflow||"auto","hidden"!=(Element.getStyle(e,"overflow")||"visible")&&(e.style.overflow="hidden")),e},undoClipping:function(e){return(e=$(e))._overflow&&(e.style.overflow="auto"==e._overflow?"":e._overflow,e._overflow=null),e}},Object.extend(Element.Methods,{childOf:Element.Methods.descendantOf}),Element._attributeTranslations={},Element._attributeTranslations.names={colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",datetime:"dateTime",accesskey:"accessKey",tabindex:"tabIndex",enctype:"encType",maxlength:"maxLength",readonly:"readOnly",longdesc:"longDesc"},Element._attributeTranslations.values={_getAttr:function(e,t){returne.getAttribute(t,2)},_flag:function(e,t){return$(e).hasAttribute(t)?t:null},style:function(e){returne.style.cssText.toLowerCase()},title:function(e){vart=e.getAttributeNode("title");returnt.specified?t.nodeValue:null}},Object.extend(Element._attributeTranslations.values,{href:Element._attributeTranslations.values._getAttr,src:Element._attributeTranslations.values._getAttr,disabled:Element._attributeTranslations.values._flag,checked:Element._attributeTranslations.values._flag,readonly:Element._attributeTranslations.values._flag,multiple:Element._attributeTranslations.values._flag}),Element.Methods.Simulated={hasAttribute:function(e,t){returnt=Element._attributeTranslations.names[t]||t,$(e).getAttributeNode(t).specified}},document.all&&!window.opera&&(Element.Methods.update=function(t,e){t=$(t),e=void0===e?"":e.toString();varn=t.tagName.toUpperCase();if(["THEAD","TBODY","TR","TD"].include(n)){varr=document.createElement("div");switch(n){case"THEAD":case"TBODY":r.innerHTML="<table><tbody>"+e.stripScripts()+"</tbody></table>",depth=2;break;case"TR":r.innerHTML="<table><tbody><tr>"+e.stripScripts()+"</tr></tbody></table>",depth=3;break;case"TD":r.innerHTML="<table><tbody><tr><td>"+e.stripScripts()+"</td></tr></tbody></table>",depth=4}$A(t.childNodes).each(function(e){t.removeChild(e)}),depth.times(function(){r=r.firstChild}),$A(r.childNodes).each(function(e){t.appendChild(e)})}elset.innerHTML=e.stripScripts();returnsetTimeout(function(){e.evalScripts()},10),t}),Object.extend(Element,Element.Methods);var_nativeExtensions=!1;/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&["","Form","Input","TextArea","Select"].each(function(e){vart="HTML"+e+"Element";window[t]||((window[t]={}).prototype=document.createElement(e?e.toLowerCase():"div").__proto__)}),Element.addMethods=function(e){functiont(e,t,n){n=n||!1;varr=Element.extend.cache;for(variine){vars=e[i];n&&iint||(t[i]=r.findOrStore(s))}}Object.extend(Element.Methods,e||{}),"undefined"!=typeofHTMLElement&&(t(Element.Methods,HTMLElement.prototype),t(Element.Methods.Simulated,HTMLElement.prototype,!0),t(Form.Methods,HTMLFormElement.prototype),[HTMLInputElement,HTMLTextAreaElement,HTMLSelectElement].each(function(e){t(Form.Element.Methods,e.prototype)}),_nativeExtensions=!0)};varToggle=newObject;Toggle.display=Element.toggle,Abstract.Insertion=function(e){this.adjacency=e},Abstract.Insertion.prototype={initialize:function(e,t){if(this.element=$(e),this.content=t.stripScripts(),this.adjacency&&this.element.insertAdjacentHTML)try{this.element.insertAdjacentHTML(this.adjacency,this.content)}catch(r){varn=this.element.tagName.toUpperCase();if(!["TBODY","TR"].include(n))throwr;this.insertContent(this.contentFromAnonymousTable())}elsethis.range=this.element.ownerDocument.createRange(),this.initializeRange&&this.initializeRange(),this.insertContent([this.range.createContextualFragment(this.content)]);setTimeout(function(){t.evalScripts()},10)},contentFromAnonymousTable:function(){vare=document.createElement("div");returne.innerHTML="<table><tbody>"+this.content+"</tbody></table>",$A(e.childNodes[0].childNodes[0].childNodes)}};varInsertion=newObject;Insertion.Before=Class.create(),Insertion.Before.prototype=Object.extend(newAbstract.Insertion("beforeBegin"),{initializeRange:function(){this.range.setStartBefore(this.element)},insertContent:function(e){e.each(function(e){this.element.parentNode.insertBefore(e,this.element)}.bind(this))}}),Insertion.Top=Class.create(),Insertion.Top.prototype=Object.extend(newAbstract.Insertion("afterBegin"),{initializeRange:function(){this.range.selectNodeContents(this.element),this.range.collapse(!0)},insertContent:function(e){e.reverse(!1).each(function(e){this.element.insertBefore(e,this.element.firstChild)}.bind(this))}}),Insertion.Bottom=Class.create(),Insertion.Bottom.prototype=Object.extend(newAbstract.Insertion("beforeEnd"),{initializeRange:function(){this.range.selectNodeContents(this.element),this.range.collapse(this.element)},insertContent:function(e){e.each(function(e){this.element.appendChild(e)}.bind(this))}}),Insertion.After=Class.create(),Insertion.After.prototype=Object.extend(newAbstract.Insertion("afterEnd"),{initializeRange:function(){this.range.setStartAfter(this.element)},insertContent:function(e){e.each(function(e){this.element.parentNode.insertBefore(e,this.element.nextSibling)}.bind(this))}}),Element.ClassNames=Class.create(),Element.ClassNames.prototype={initialize:function(e){this.element=$(e)},_each:function(e){this.element.className.split(/\s+/).select(function(e){return0<e.length})._each(e)},set:function(e){this.element.className=e},add:function(e){this.include(e)||this.set($A(this).concat(e).join(""))},remove:function(e){this.include(e)&&this.set($A(this).without(e).join(""))},toString:function(){return$A(this).join("")}},Object.extend(Element.ClassNames.prototype,Enumerable);varSelector=Class.create();Selector.prototype={initialize:function(e){this.params={classNames:[]},this.expression=e.toString().strip(),this.parseExpression(),this.compileMatcher()},parseExpression:function(){functione(e){throw"Parseerrorinselector:"+e}""==this.expression&&e("emptyexpression");for(vart,n,r,i,s=this.params,o=this.expression;t=o.match(/^(.*)\[([a-z0-9_:-]+?)(?:([~\|!]?=)(?:"([^"]*)"|([^\]\s]*)))?\]$/i);)s.attributes=s.attributes||[],s.attributes.push({name:t[2],operator:t[3],value:t[4]||t[5]||""}),o=t[1];if("*"==o)returnthis.params.wildcard=!0;for(;t=o.match(/^([^a-z0-9_-])?([a-z0-9_-]+)(.*)/i);){switch(n=t[1],r=t[2],i=t[3],n){case"#":s.id=r;break;case".":s.classNames.push(r);break;case"":caseundefined:s.tagName=r.toUpperCase();break;default:e(o.inspect())}o=i}0<o.length&&e(o.inspect())},buildMatchExpression:function(){vare,t=this.params,r=[];if(t.wildcard&&r.push("true"),(e=t.id)&&r.push('element.readAttribute("id")=='+e.inspect()),(e=t.tagName)&&r.push("element.tagName.toUpperCase()=="+e.inspect()),0<(e=t.classNames).length)for(varn=0,i=e.length;n<i;n++)r.push("element.hasClassName("+e[n].inspect()+")");return(e=t.attributes)&&e.each(function(e){vart="element.readAttribute("+e.name.inspect()+")",n=function(e){returnt+"&&"+t+".split("+e.inspect()+")"};switch(e.operator){case"=":r.push(t+"=="+e.value.inspect());break;case"~=":r.push(n("")+".include("+e.value.inspect()+")");break;case"|=":r.push(n("-")+".first().toUpperCase()=="+e.value.toUpperCase().inspect());break;case"!=":r.push(t+"!="+e.value.inspect());break;case"":caseundefined:r.push("element.hasAttribute("+e.name.inspect()+")");break;default:throw"Unknownoperator"+e.operator+"inselector"}}),r.join("&&")},compileMatcher:function(){this.match=newFunction("element","if(!element.tagName)returnfalse;element=$(element);return"+this.buildMatchExpression())},findElements:function(e){vart;if((t=$(this.params.id))&&this.match(t)&&(!e||Element.childOf(t,e)))return[t];for(varn=[],r=0,i=(e=(e||document).getElementsByTagName(this.params.tagName||"*")).length;r<i;r++)this.match(t=e[r])&&n.push(Element.extend(t));returnn},toString:function(){returnthis.expression}},Object.extend(Selector,{matchElements:function(e,t){varn=newSelector(t);returne.select(n.match.bind(n)).map(Element.extend)},findElement:function(e,t,n){return"number"==typeoft&&(n=t,t=!1),Selector.matchElements(e,t||"*")[n||0]},findChildElements:function(r,e){returne.map(function(e){returne.match(/[^\s"]+(?:"[^"]*"[^\s"]+)*/g).inject([null],function(e,t){varn=newSelector(t);returne.inject([],function(e,t){returne.concat(n.findElements(t||r))})})}).flatten()}});varForm={reset:function(e){return$(e).reset(),e},serializeElements:function(e,t){varn=e.inject({},function(e,t){if(!t.disabled&&t.name){varn=t.name,r=$(t).getValue();r!=undefined&&(e[n]?(e[n].constructor!=Array&&(e[n]=[e[n]]),e[n].push(r)):e[n]=r)}returne});returnt?n:Hash.toQueryString(n)}};Form.Methods={serialize:function(e,t){returnForm.serializeElements(Form.getElements(e),t)},getElements:function(e){return$A($(e).getElementsByTagName("*")).inject([],function(e,t){returnForm.Element.Serializers[t.tagName.toLowerCase()]&&e.push(Element.extend(t)),e})},getInputs:function(e,t,n){varr=(e=$(e)).getElementsByTagName("input");if(!t&&!n)return$A(r).map(Element.extend);for(vari=0,s=[],o=r.length;i<o;i++){vara=r[i];t&&a.type!=t||n&&a.name!=n||s.push(Element.extend(a))}returns},disable:function(e){return(e=$(e)).getElements().each(function(e){e.blur(),e.disabled="true"}),e},enable:function(e){return(e=$(e)).getElements().each(function(e){e.disabled=""}),e},findFirstElement:function(e){return$(e).getElements().find(function(e){return"hidden"!=e.type&&!e.disabled&&["input","select","textarea"].include(e.tagName.toLowerCase())})},focusFirstElement:function(e){return(e=$(e)).findFirstElement().activate(),e}},Object.extend(Form,Form.Methods),Form.Element={focus:function(e){return$(e).focus(),e},select:function(e){return$(e).select(),e}},Form.Element.Methods={serialize:function(e){if(!(e=$(e)).disabled&&e.name){vart=e.getValue();if(t!=undefined){varn={};returnn[e.name]=t,Hash.toQueryString(n)}}return""},getValue:function(e){vart=(e=$(e)).tagName.toLowerCase();returnForm.Element.Serializers[t](e)},clear:function(e){return$(e).value="",e},present:function(e){return""!=$(e).value},activate:function(e){return(e=$(e)).focus(),!e.select||"input"==e.tagName.toLowerCase()&&["button","reset","submit"].include(e.type)||e.select(),e},disable:function(e){return(e=$(e)).disabled=!0,e},enable:function(e){return(e=$(e)).blur(),e.disabled=!1,e}},Object.extend(Form.Element,Form.Element.Methods);varField=Form.Element,$F=Form.Element.getValue;if(Form.Element.Serializers={input:function(e){switch(e.type.toLowerCase()){case"checkbox":case"radio":returnForm.Element.Serializers.inputSelector(e);default:returnForm.Element.Serializers.textarea(e)}},inputSelector:function(e){returne.checked?e.value:null},textarea:function(e){returne.value},select:function(e){returnthis["select-one"==e.type?"selectOne":"selectMany"](e)},selectOne:function(e){vart=e.selectedIndex;return0<=t?this.optionValue(e.options[t]):null},selectMany:function(e){vart=e.length;if(!t)returnnull;for(varn=0,r=[];n<t;n++){vari=e.options[n];i.selected&&r.push(this.optionValue(i))}returnr},optionValue:function(e){returnElement.extend(e).hasAttribute("value")?e.value:e.text}},Abstract.TimedObserver=function(){},Abstract.TimedObserver.prototype={initialize:function(e,t,n){this.frequency=t,this.element=$(e),this.callback=n,this.lastValue=this.getValue(),this.registerCallback()},registerCallback:function(){setInterval(this.onTimerEvent.bind(this),1e3*this.frequency)},onTimerEvent:function(){vare=this.getValue();("string"==typeofthis.lastValue&&"string"==typeofe?this.lastValue!=e:String(this.lastValue)!=String(e))&&(this.callback(this.element,e),this.lastValue=e)}},Form.Element.Observer=Class.create(),Form.Element.Observer.prototype=Object.extend(newAbstract.TimedObserver,{getValue:function(){returnForm.Element.getValue(this.element)}}),Form.Observer=Class.create(),Form.Observer.prototype=Object.extend(newAbstract.TimedObserver,{getValue:function(){returnForm.serialize(this.element)}}),Abstract.EventObserver=function(){},Abstract.EventObserver.prototype={initialize:function(e,t){this.element=$(e),this.callback=t,this.lastValue=this.getValue(),"form"==this.element.tagName.toLowerCase()?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){vare=this.getValue();this.lastValue!=e&&(this.callback(this.element,e),this.lastValue=e)},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback.bind(this))},registerCallback:function(e){if(e.type)switch(e.type.toLowerCase()){case"checkbox":case"radio":Event.observe(e,"click",this.onElementEvent.bind(this));break;default:Event.observe(e,"change",this.onElementEvent.bind(this))}}},Form.Element.EventObserver=Class.create(),Form.Element.EventObserver.prototype=Object.extend(newAbstract.EventObserver,{getValue:function(){returnForm.Element.getValue(this.element)}}),Form.EventObserver=Class.create(),Form.EventObserver.prototype=Object.extend(newAbstract.EventObserver,{getValue:function(){returnForm.serialize(this.element)}}),!window.Event)varEvent=newObject;Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,element:function(e){returne.target||e.srcElement},isLeftClick:function(e){returne.which&&1==e.which||e.button&&1==e.button},pointerX:function(e){returne.pageX||e.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)},pointerY:function(e){returne.pageY||e.clientY+(document.documentElement.scrollTop||document.body.scrollTop)},stop:function(e){e.preventDefault?(e.preventDefault(),e.stopPropagation()):(e.returnValue=!1,e.cancelBubble=!0)},findElement:function(e,t){for(varn=Event.element(e);n.parentNode&&(!n.tagName||n.tagName.toUpperCase()!=t.toUpperCase());)n=n.parentNode;returnn},observers:!1,_observeAndCache:function(e,t,n,r){this.observers||(this.observers=[]),e.addEventListener?(this.observers.push([e,t,n,r]),e.addEventListener(t,n,r)):e.attachEvent&&(this.observers.push([e,t,n,r]),e.attachEvent("on"+t,n))},unloadCache:function(){if(Event.observers){for(vare=0,t=Event.observers.length;e<t;e++)Event.stopObserving.apply(this,Event.observers[e]),Event.observers[e][0]=null;Event.observers=!1}},observe:function(e,t,n,r){e=$(e),r=r||!1,"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.attachEvent)&&(t="keydown"),Event._observeAndCache(e,t,n,r)},stopObserving:function(e,t,n,r){if(e=$(e),r=r||!1,"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.detachEvent)&&(t="keydown"),e.removeEventListener)e.removeEventListener(t,n,r);elseif(e.detachEvent)try{e.detachEvent("on"+t,n)}catch(i){}}}),navigator.appVersion.match(/\bMSIE\b/)&&Event.observe(window,"unload",Event.unloadCache,!1);varPosition={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},realOffset:function(e){for(vart=0,n=0;t+=e.scrollTop||0,n+=e.scrollLeft||0,e=e.parentNode;);return[n,t]},cumulativeOffset:function(e){for(vart=0,n=0;t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent;);return[n,t]},positionedOffset:function(e){vart=0,n=0;do{if(t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent){if("BODY"==e.tagName)break;varr=Element.getStyle(e,"position");if("relative"==r||"absolute"==r)break}}while(e);return[n,t]},offsetParent:function(e){if(e.offsetParent)returne.offsetParent;if(e==document.body)returne;for(;(e=e.parentNode)&&e!=document.body;)if("static"!=Element.getStyle(e,"position"))returne;returndocument.body},within:function(e,t,n){returnthis.includeScrollOffsets?this.withinIncludingScrolloffsets(e,t,n):(this.xcomp=t,this.ycomp=n,this.offset=this.cumulativeOffset(e),n>=this.offset[1]&&n<this.offset[1]+e.offsetHeight&&t>=this.offset[0]&&t<this.offset[0]+e.offsetWidth)},withinIncludingScrolloffsets:function(e,t,n){varr=this.realOffset(e);returnthis.xcomp=t+r[0]-this.deltaX,this.ycomp=n+r[1]-this.deltaY,this.offset=this.cumulativeOffset(e),this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+e.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+e.offsetWidth},overlap:function(e,t){returne?"vertical"==e?(this.offset[1]+t.offsetHeight-this.ycomp)/t.offsetHeight:"horizontal"==e?(this.offset[0]+t.offsetWidth-this.xcomp)/t.offsetWidth:void0:0},page:function(e){vart=0,n=0,r=e;do{if(t+=r.offsetTop||0,n+=r.offsetLeft||0,r.offsetParent==document.body&&"absolute"==Element.getStyle(r,"position"))break}while(r=r.offsetParent);for(r=e;window.opera&&"BODY"!=r.tagName||(t-=r.scrollTop||0,n-=r.scrollLeft||0),r=r.parentNode;);return[n,t]},clone:function(e,t,n){varr=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},n||{});e=$(e);vari=Position.page(e);t=$(t);vars=[0,0],o=null;"absolute"==Element.getStyle(t,"position")&&(o=Position.offsetParent(t),s=Position.page(o)),o==document.body&&(s[0]-=document.body.offsetLeft,s[1]-=document.body.offsetTop),r.setLeft&&(t.style.left=i[0]-s[0]+r.offsetLeft+"px"),r.setTop&&(t.style.top=i[1]-s[1]+r.offsetTop+"px"),r.setWidth&&(t.style.width=e.offsetWidth+"px"),r.setHeight&&(t.style.height=e.offsetHeight+"px")},absolutize:function(e){if("absolute"!=(e=$(e)).style.position){Position.prepare();vart=Position.positionedOffset(e),n=t[1],r=t[0],i=e.clientWidth,s=e.clientHeight;e._originalLeft=r-parseFloat(e.style.left||0),e._originalTop=n-parseFloat(e.style.top||0),e._originalWidth=e.style.width,e._originalHeight=e.style.height,e.style.position="absolute",e.style.top=n+"px",e.style.left=r+"px",e.style.width=i+"px",e.style.height=s+"px"}},relativize:function(e){if("relative"!=(e=$(e)).style.position){Position.prepare(),e.style.position="relative";vart=parseFloat(e.style.top||0)-(e._originalTop||0),n=parseFloat(e.style.left||0)-(e._originalLeft||0);e.style.top=t+"px",e.style.left=n+"px",e.style.height=e._originalHeight,e.style.width=e._originalWidth}}};/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&(Position.cumulativeOffset=function(e){vart=0,n=0;do{if(t+=e.offsetTop||0,n+=e.offsetLeft||0,e.offsetParent==document.body&&"absolute"==Element.getStyle(e,"position"))break;e=e.offsetParent}while(e);return[n,t]}),Element.addMethods(),shortcut={all_shortcuts:{},add:function(u,l,h){vare={type:"keydown",propagate:!1,disable_in_input:!1,target:document,keycode:!1};if(h)for(vartine)"undefined"==typeofh[t]&&(h[t]=e[t]);elseh=e;varn=h.target;"string"==typeofh.target&&(n=document.getElementById(h.target));u=u.toLowerCase();varr=function(e){vart;if((e=e||window.event,h.disable_in_input)&&(e.target?t=e.target:e.srcElement&&(t=e.srcElement),3==t.nodeType&&(t=t.parentNode),"INPUT"==t.tagName||"TEXTAREA"==t.tagName))return;e.keyCode?code=e.keyCode:e.which&&(code=e.which);varn=String.fromCharCode(code).toLowerCase();188==code&&(n=","),190==code&&(n=".");varr=u.split("+"),i=0,s={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},o={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},a={shift:{wanted:!1,pressed:!1},ctrl:{wanted:!1,pressed:!1},alt:{wanted:!1,pressed:!1},meta:{wanted:!1,pressed:!1}};e.ctrlKey&&(a.ctrl.pressed=!0),e.shiftKey&&(a.shift.pressed=!0),e.altKey&&(a.alt.pressed=!0),e.metaKey&&(a.meta.pressed=!0);for(varc=0;k=r[c],c<r.length;c++)"ctrl"==k||"control"==k?(i++,a.ctrl.wanted=!0):"shift"==k?(i++,a.shift.wanted=!0):"alt"==k?(i++,a.alt.wanted=!0):"meta"==k?(i++,a.meta.wanted=!0):1<k.length?o[k]==code&&i++:h.keycode?h.keycode==code&&i++:n==k?i++:s[n]&&e.shiftKey&&(n=s[n])==k&&i++;if(i==r.length&&a.ctrl.pressed==a.ctrl.wanted&&a.shift.pressed==a.shift.wanted&&a.alt.pressed==a.alt.wanted&&a.meta.pressed==a.meta.wanted&&(l(e),!h.propagate))returne.cancelBubble=!0,e.returnValue=!1,e.stopPropagation&&(e.stopPropagation(),e.preventDefault()),!1};this.all_shortcuts[u]={callback:r,target:n,event:h.type},n.addEventListener?n.addEventListener(h.type,r,!1):n.attachEvent?n.attachEvent("on"+h.type,r):n["on"+h.type]=r},remove:function(e){e=e.toLowerCase();vart=this.all_shortcuts[e];if(deletethis.all_shortcuts[e],t){varn=t.event,r=t.target,i=t.callback;r.detachEvent?r.detachEvent("on"+n,i):r.removeEventListener?r.removeEventListener(n,i,!1):r["on"+n]=!1}}};varVendor=newObject;Vendor.insertContent=function(e,t){if(myField=document.getElementById(e),document.selection)myField.focus(),sel=document.selection.createRange(),sel.text=t,myField.focus();elseif(myField.selectionStart||"0"==myField.selectionStart){varn=myField.selectionStart,r=myField.selectionEnd,i=myField.scrollTop;myField.value=myField.value.substring(0,n)+t+myField.value.substring(r,myField.value.length),myField.focus(),myField.selectionStart=n+t.length,myField.selectionEnd=n+t.length,myField.scrollTop=i}elsemyField.value+=t,myField.focus()},Vendor.copyToClipboard=function(e){if(e.createTextRange){vart=e.createTextRange();t&&t.execCommand("Copy")}else{varn="flashcopier";if(!document.getElementById(n)){varr=document.createElement("div");r.id=n,document.body.appendChild(r)}document.getElementById(n).innerHTML="";vari='<embedsrc="/images/_clipboard.swf"FlashVars="clipboard='+encodeURIComponent(e)+'"width="0"height="0"type="application/x-shockwave-flash"></embed>';document.getElementById(n).innerHTML=i}};varRubular={lastMessageSent:0,lastMessageReceived:-1,testStringHasFocus:!1,inErrorState:!1,defaultRequestHeaders:function(){return{asynchronous:!0,evalScripts:!0}},example:function(){vare=newDate;$("regex").value="(?<month>\\d{1,2})\\/(?<day>\\d{1,2})\\/(?<year>\\d{4})",$("test").value="Today'sdateis:"+(e.getMonth()+1)+"/"+e.getDate()+"/"+e.getFullYear()+"."},clearFields:function(e,t,n){$("regex").value=Rubular.useIfDefined(e),$("options").value=Rubular.useIfDefined(t),$("test").value=Rubular.useIfDefined(n)},useIfDefined:function(e){returnvoid0===e?"":e},showSpinner:function(){$("ajax_loader_wrapper").show()},hideSpinner:function(){$("ajax_loader_wrapper").hide()},testRegex:function(e,t,n){varr=Object.extend({force:!1},n||{});if(!(this.isEditorEmpty()||this.inErrorState&&!r.force)){this.showSpinner();vari=++this.lastMessageSent;this.pendingRequest&&this.pendingRequest.transport&&4!=this.pendingRequest.transport.readyState&&(this.pendingRequest.transport.abort(),this.pendingRequest=null),this.pendingRequest=newAjax.Request("/regex/do_test?message_id="+i,Object.extend(this.defaultRequestHeaders(),{parameters:t,on0:this.onRegexParseError.bind(this,i),onFailure:this.onRegexParseError.bind(this,i)}))}},onRegexParseError:function(e){this.lastMessageSent==e&&(this.recordLastMessageReceived(e),this.handleParseError("Oops,therewasanerrorhandlingyourregex.We'lltryagaininafewseconds."))},handleParseResult:function(e){this.lastMessageSent==e.message_id&&(this.recordLastMessageReceived(e.message_id),e.retry?this.handleParseError(e.error_message):(Element.update("result",e.html),this.handleParseSuccess()))},recordLastMessageReceived:function(e){this.lastMessageReceived=e},handleParseSuccess:function(){this.inErrorState=!1,this.hideSpinner(),this.clearNotice()},handleParseError:function(e){this.showNotice(e,{fade:!1}),this.inErrorState=!0,this.scheduleAutoRetry()},scheduleAutoRetry:function(){this.hideSpinner(),setTimeout(function(){this.showNotice("Ok,tryingagain...",{fade:!1}),this.showSpinner(),setTimeout(function(){this.testRegex($("test_form"),Form.serialize("test_form"),{force:!0})}.bind(this),3e3)}.bind(this),6e3)},isEditorEmpty:function(){return$("start_instructions")&&(""==$("regex").value||""==$("test").value)},insertTab:function(){Vendor.insertContent("test",String.fromCharCode(9))},copyRegexToClipboard:function(){if(""==$("regex").value)this.showNotice("Enteraregularexpressionfirst!");else{vare="/"+$F("regex")+"/"+$F("options");Vendor.copyToClipboard(e),this.showNotice("Yourregexhasbeencopiedtoyourclipboard!")}},showNotice:function(e,t){varn={fade:!0};Object.extend(n,t||{});varr=$("ajax_note");r.innerHTML=e,r.show(),n.fade&&setTimeout(function(){r.innerHTML==e&&this.clearNotice()},6e3+10*e.length)},clearNotice:function(){$("ajax_note").innerHTML="",$("ajax_note").hide()},makePermalink:function(){this.isEditorEmpty()?this.showNotice("Tocreateapermalink,firstenteraregularexpressionandateststring."):newAjax.Request("/regex/make_permalink",Object.extend(this.defaultRequestHeaders(),{parameters:Form.serialize("test_form"),onFailure:this.onRegexParseError}))}};Event.observe(window,"load",function(){shortcut.add("Control+Shift+S",function(){Rubular.testStringHasFocus&&Rubular.insertTab()}),$("test_form").getElements().each(function(e){Event.observe(e,"focus",function(e){Rubular.testStringHasFocus="test"==Event.element(e).id})}),newForm.Observer("test_form",.2,function(e,t){Rubular.testRegex(e,t)})});
